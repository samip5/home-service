# Only define the known VLAN subnets as trusted
acl "trusted" {
  10.0.50.0/24;    # IOT
  192.168.2.0/24; # LAN
  172.16.9.0/24;    # CONTAINERS
  10.0.105.0/24;   #KubernetesProd
  2001:14ba:16d1:9600::/64;
};

options {
  directory "/var/cache/bind";
  listen-on { 127.0.0.1; 172.16.9.3; };
  listen-on-v6 { fdbc:baa4:65a9::3; };

#  dns64 2a00:1098:2b::/96 {
  #	clients { any; };
  #	exclude { 0::/3; 4000::/2; 8000::/1; 2001:db8::/32; };
  #};

#  dns64 2a00:1098:2c:1::/96 {
#	clients { any; };
#	exclude { 0::/3; 4000::/2; 8000::/1; 2001:db8::/32; };
#  };

#  dns64 2a01:4f8:c2c:123f:64::/96 {
#	clients { any; };
#	exclude { 0::/3; 4000::/2; 8000::/1; 2001:db8::/32; };
#  };
  include "/var/lib/bind/dns64.conf";

  allow-recursion {
    trusted;
  };
  allow-transfer {
    none;
  };
  allow-update {
    none;
  };
};

logging {
  channel stdout {
    stderr;
    severity info;
    print-category yes;
    print-severity yes;
    print-time yes;
  };
  category security { stdout; };
  category dnssec   { stdout; };
  category default  { stdout; };
};

include "/etc/bind/rndc.sops.key";
include "/etc/bind/externaldns.sops.key";
#include "/var/lib/bind/dns64.conf";


controls {
  inet 127.0.0.1 allow { localhost; } keys { "rndc-key"; };
};

zone "unifi." {
  type master;
  file "/etc/bind/zones/db.unifi";
};

zone "media.skylab.fi." {
  type master;
  file "/etc/bind/zones/db.media.skylab.fi";
  journal "/var/cache/bind/db.media.skylab.fi.jnl";
  allow-transfer {
    key "externaldns";
  };
  update-policy {
    grant externaldns zonesub ANY;
  };
};

zone "skylab.fi." {
  type master;
  file "/etc/bind/zones/db.skylab.fi";
  journal "/var/cache/bind/db.skylab.fi.jnl";
  allow-transfer {
    key "externaldns";
  };
  update-policy {
    grant externaldns zonesub ANY;
  };
};
